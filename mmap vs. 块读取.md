# mmap vs. 块读取

> origin stackoverflow site: https://stackoverflow.com/questions/45972/mmap-vs-reading-blocks

## 问题：

我正在编写一个可能会读取并处理大小为 100GB 甚至更大的文件，文件中包含了变量长度的集合。我已经实现了第一个版本，现在想优化下性能，尤其是在 IO 上，因为在读取文件的时候花费了太多时间。

使用 C++ 的 `fstream` 库在进行块读取的时候有没有什么经验法则吗？我想做的是读取一个大的块到缓冲里，然后从缓冲中读取完成的记录。

`mmap()` 可能会让代码变得非常混乱，因为 `mmap` 的块需要位于页面大小的边界内（我自己的理解），而我要处理的那些记录可能跨越页面的边界。使用 `fstream` 我可以定位到记录的开始然后开始重新读取，而不用局限于阅读页面大小边界内的块。

我如何在它们之间做出选中而不需要写出完整的实现代码？有什么经验法则（比如 `mmap()` 有 2 倍的性能优势）或者一些简单的测试吗？

## 回答